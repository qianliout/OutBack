在PyTorch中，`torch.cat()` 是一个用于**沿指定维度拼接多个张量**的函数。它不会新增维度，而是直接在现有维度上扩展数据。以下是其详细用法及参数说明：

***

### **1. 函数定义**

```python
torch.cat(tensors, dim=0, *, out=None) → Tensor
```

*   **参数**：
    *   `tensors` (sequence of Tensors): 需要拼接的张量序列（如列表或元组）。
    *   `dim` (int, optional): 沿哪个维度拼接（默认`dim=0`）。
    *   `out` (Tensor, optional): 可选输出张量（一般不手动指定）。
*   **返回值**：拼接后的新张量。

***

### **2. 关键规则**

1.  **所有张量的形状必须相同**（除了拼接维度 `dim` 的大小可以不同）。
2.  **拼接维度外的其他维度必须完全一致**，否则会报错。
3.  **不会新增维度**，而是在现有维度上扩展。

***

### **3. 参数详解与示例**

#### **(1) `tensors`：待拼接的张量序列**

*   必须是**同类型张量**（如全是`FloatTensor`或`IntTensor`）。
*   张量的形状需满足拼接条件。

#### **(2) `dim`：指定拼接的维度**

*   **`dim=0`**：沿第0维（行方向）拼接。
*   **`dim=1`**：沿第1维（列方向）拼接。
*   **`dim=-1`**：沿最后一维拼接。

***

### **4. 具体示例**

#### **示例1：沿第0维拼接（垂直堆叠）**

```python
import torch

x = torch.tensor([[1, 2], [3, 4]])  # shape: (2, 2)
y = torch.tensor([[5, 6]])          # shape: (1, 2)

z = torch.cat([x, y], dim=0)        # 沿行方向拼接
print(z)
```

输出：

    tensor([[1, 2],
            [3, 4],
            [5, 6]])

**形状变化**：`(2,2)` + `(1,2)` → `(3,2)`。

#### **示例2：沿第1维拼接（水平堆叠）**

```python
x = torch.tensor([[1, 2], [3, 4]])  # shape: (2, 2)
y = torch.tensor([[5], [6]])        # shape: (2, 1)

z = torch.cat([x, y], dim=1)        # 沿列方向拼接
print(z)
```

输出：

    tensor([[1, 2, 5],
            [3, 4, 6]])

**形状变化**：`(2,2)` + `(2,1)` → `(2,3)`。

#### **示例3：高维张量拼接**

```python
x = torch.randn(2, 3, 4)  # shape: (2, 3, 4)
y = torch.randn(2, 1, 4)  # shape: (2, 1, 4)

z = torch.cat([x, y], dim=1)  # 沿第1维拼接
print(z.shape)  # torch.Size([2, 4, 4])
```

**形状变化**：`(2,3,4)` + `(2,1,4)` → `(2,4,4)`。

***

### **5. 常见用途**

1.  **合并特征图**
    ```python
    feat1 = torch.randn(32, 64, 56, 56)  # 特征图1
    feat2 = torch.randn(32, 64, 56, 56)  # 特征图2
    combined = torch.cat([feat1, feat2], dim=1)  # 沿通道维拼接 → (32,128,56,56)
    ```
2.  **批量数据拼接**
    ```python
    batch1 = torch.randn(10, 5)  # 第一批数据
    batch2 = torch.randn(15, 5)  # 第二批数据
    full_batch = torch.cat([batch1, batch2], dim=0)  # (25,5)
    ```
3.  **时间序列数据拼接**
    ```python
    seq1 = torch.randn(10, 3, 20)  # 序列1
    seq2 = torch.randn(10, 5, 20)  # 序列2
    long_seq = torch.cat([seq1, seq2], dim=1)  # (10,8,20)
    ```

***

### **6. 与 `torch.stack` 的区别**

| 方法                | 新增维度 | 输入要求       | 示例                                       |
| ----------------- | ---- | ---------- | ---------------------------------------- |
| **`torch.cat`**   | 否    | 仅拼接维度大小可不同 | `cat([(2,3), (2,5)], dim=1) → (2,8)`     |
| **`torch.stack`** | 是    | 所有形状必须完全相同 | `stack([(3,4), (3,4)], dim=0) → (2,3,4)` |

***

### **7. 易错点**

1.  **形状不匹配**：
    ```python
    x = torch.randn(2, 3)
    y = torch.randn(3, 2)
    z = torch.cat([x, y], dim=1)  # 报错！其他维度不一致
    ```
2.  **空张量**：\
    `torch.cat([])` 会报错（至少需要一个张量）。

***

### **8. 总结**

*   **核心功能**：沿指定维度拼接多个张量，扩展数据。
*   **关键参数**：
    *   `tensors`：待拼接的张量列表。
    *   `dim`：指定拼接的维度（支持负数索引）。
*   **典型场景**：特征融合、批量数据合并、序列拼接。

通过合理使用 `torch.cat()`，可以高效整合张量数据！
