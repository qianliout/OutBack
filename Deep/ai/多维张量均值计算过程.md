### \*\* å‡å€¼è®¡ç®—è¿‡ç¨‹\*\*

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª **4D å¼ é‡ `X`**ï¼ˆå¦‚ CNN ä¸­çš„ä¸€æ‰¹å›¾åƒæ•°æ®ï¼‰ï¼Œå…¶å½¢çŠ¶ä¸º `(batch_size, channels, height, width)`ã€‚æˆ‘ä»¬è®¡ç®— `mean` æ—¶æŒ‡å®š `dim=(0, 2, 3)`ï¼Œè¡¨ç¤ºåœ¨ **ç¬¬0ã€2ã€3ç»´åº¦ä¸Šæ±‚å‡å€¼**ï¼Œè€Œä¿ç•™ **ç¬¬1ç»´åº¦ï¼ˆchannelsï¼‰ä¸å˜**ã€‚

***

### **1. è¾“å…¥æ•°æ®ç¤ºä¾‹**

è®¾ `X` æ˜¯ä¸€ä¸ª `(2, 3, 2, 2)` çš„å¼ é‡ï¼ˆå³ `batch_size=2`ï¼Œ`channels=3`ï¼Œ`height=2`ï¼Œ`width=2`ï¼‰ï¼Œå…¶å€¼ä¸ºï¼š

```python
import torch

X = torch.tensor([
    # æ ·æœ¬ 0 (batch=0)
    [
        [[1, 2], [3, 4]],  # é€šé“ 0
        [[5, 6], [7, 8]],   # é€šé“ 1
        [[9, 10], [11, 12]] # é€šé“ 2
    ],
    # æ ·æœ¬ 1 (batch=1)
    [
        [[13, 14], [15, 16]],  # é€šé“ 0
        [[17, 18], [19, 20]],  # é€šé“ 1
        [[21, 22], [23, 24]]   # é€šé“ 2
    ]
], dtype=torch.float32)

print(X.shape)  # è¾“å‡º: torch.Size([2, 3, 2, 2])
```

***

### **2. è®¡ç®— `mean(dim=(0, 2, 3))` çš„æ­¥éª¤**

`dim=(0, 2, 3)` è¡¨ç¤ºå¯¹ **ç¬¬0ç»´ï¼ˆbatchï¼‰ã€ç¬¬2ç»´ï¼ˆheightï¼‰ã€ç¬¬3ç»´ï¼ˆwidthï¼‰** æ±‚å‡å€¼ï¼Œä¿ç•™ **ç¬¬1ç»´ï¼ˆchannelsï¼‰**ã€‚

#### **(1) åˆ†ç»„è®¡ç®—ï¼ˆæŒ‰ channel è®¡ç®—å‡å€¼ï¼‰**

å¯¹äºæ¯ä¸ªé€šé“ `c`ï¼Œè®¡ç®—æ‰€æœ‰æ ·æœ¬ï¼ˆbatchï¼‰ã€æ‰€æœ‰è¡Œï¼ˆheightï¼‰ã€æ‰€æœ‰åˆ—ï¼ˆwidthï¼‰çš„å‡å€¼ï¼š

*   **é€šé“ 0** çš„å‡å€¼ï¼š
    \[ \text{mean}\_0 = \frac{1 + 2 + 3 + 4 + 13 + 14 + 15 + 16}{8} = \frac{68}{8} = 8.5 ]
*   **é€šé“ 1** çš„å‡å€¼ï¼š
    \[
    \text{mean}\_1 = \frac{5 + 6 + 7 + 8 + 17 + 18 + 19 + 20}{8} = \frac{100}{8} = 12.5
    ]
*   **é€šé“ 2** çš„å‡å€¼ï¼š
    \[
    \text{mean}\_2 = \frac{9 + 10 + 11 + 12 + 21 + 22 + 23 + 24}{8} = \frac{132}{8} = 16.5
    ]

#### **(2) è¾“å‡ºç»“æœ**

ç”±äº `keepdim=True`ï¼Œè¾“å‡ºçš„å½¢çŠ¶ä¼šä¿ç•™è¢«æ±‚å‡å€¼çš„ç»´åº¦ï¼ˆå˜ä¸º `1`ï¼‰ï¼š

```python
mean = X.mean(dim=(0, 2, 3), keepdim=True)
print(mean)  # è¾“å‡º: tensor([[[[ 8.5000]], [[12.5000]], [[16.5000]]]])
print(mean.shape)  # è¾“å‡º: torch.Size([1, 3, 1, 1])
```

*   **è§£é‡Š**ï¼š
    *   åŸå¼ é‡ `X` çš„å½¢çŠ¶æ˜¯ `(2, 3, 2, 2)`ã€‚
    *   å¯¹ `dim=(0, 2, 3)` æ±‚å‡å€¼åï¼Œè¿™äº›ç»´åº¦è¢«å‹ç¼©ä¸º `1`ï¼Œå› æ­¤è¾“å‡ºå½¢çŠ¶æ˜¯ `(1, 3, 1, 1)`ã€‚

***

### **3. å¯¹æ¯” `keepdim=False` çš„æƒ…å†µ**

å¦‚æœ `keepdim=False`ï¼Œåˆ™è¢«æ±‚å‡å€¼çš„ç»´åº¦ä¼šè¢«ç§»é™¤ï¼š

```python
mean = X.mean(dim=(0, 2, 3), keepdim=False)
print(mean)  # è¾“å‡º: tensor([ 8.5000, 12.5000, 16.5000])
print(mean.shape)  # è¾“å‡º: torch.Size([3])
```

*   **è§£é‡Š**ï¼š
    *   è¾“å‡ºç›´æ¥æ˜¯æ¯ä¸ªé€šé“çš„å‡å€¼ï¼Œå½¢çŠ¶ä¸º `(3,)`ï¼ˆå³ `channels` ç»´åº¦ï¼‰ã€‚

***

### **4. å…³é”®æ€»ç»“**

| å‚æ•°                  | è¯´æ˜                                            |
| ------------------- | --------------------------------------------- |
| **`dim=(0, 2, 3)`** | å¯¹ `batch`ã€`height`ã€`width` æ±‚å‡å€¼ï¼Œä¿ç•™ `channels`ã€‚ |
| **`keepdim=True`**  | ä¿æŒè¾“å‡ºç»´åº¦ä¸åŸå¼ é‡ä¸€è‡´ï¼ˆè¢«æ±‚å‡å€¼çš„ç»´åº¦å˜ä¸º `1`ï¼‰ã€‚                  |
| **`keepdim=False`** | ç§»é™¤è¢«æ±‚å‡å€¼çš„ç»´åº¦ï¼Œä»…ä¿ç•™ `channels`ã€‚                     |

**è®¡ç®—é€»è¾‘**ï¼š

1.  **æŒ‰ channel åˆ†ç»„**ï¼šå¯¹æ¯ä¸ªé€šé“çš„æ‰€æœ‰åƒç´ ï¼ˆè·¨ batchã€heightã€widthï¼‰è®¡ç®—å‡å€¼ã€‚
2.  **ä¿æŒç»´åº¦**ï¼š`keepdim=True` æ—¶ï¼Œè¾“å‡ºå½¢çŠ¶ä¸åŸå¼ é‡å¯¹é½ï¼Œä¾¿äºåç»­å¹¿æ’­æ“ä½œï¼ˆå¦‚æ®‹å·®è¿æ¥ï¼‰ã€‚

***

### **5. å¸¸è§åº”ç”¨åœºæ™¯**

*   **æ‰¹é‡è§„èŒƒåŒ–ï¼ˆBatchNormï¼‰**ï¼šåœ¨ `BatchNorm2d` ä¸­ï¼Œè®¡ç®—æ¯ä¸ªé€šé“çš„å‡å€¼å’Œæ–¹å·®æ—¶ä½¿ç”¨ç±»ä¼¼æ“ä½œã€‚
*   **å…¨å±€å¹³å‡æ± åŒ–ï¼ˆGlobal Average Poolingï¼‰**ï¼šå¯¹ `height` å’Œ `width` æ±‚å‡å€¼ï¼Œå¾—åˆ°æ¯ä¸ªé€šé“çš„æ ‡é‡ã€‚

å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®ä½ å½»åº•ç†è§£å¤šç»´å¼ é‡çš„å‡å€¼è®¡ç®—ï¼ ğŸš€

### **æ–¹å·®ï¼ˆVarianceï¼‰è®¡ç®—è¿‡ç¨‹è¯¦è§£**

ç»™å®šè¾“å…¥å¼ é‡ ( X \in \mathbb{R}^{2 \times 3 \times 2 \times 2} )ï¼ˆå½¢çŠ¶ï¼š`(batch_size, channels, height, width)`ï¼‰ï¼Œå…¶å€¼å¦‚ä¸‹ï¼š

```math
X = \begin{bmatrix}
\text{æ ·æœ¬ 0} & 
\begin{bmatrix}
\begin{bmatrix} 1 & 2 \\ 3 & 4 \end{bmatrix} & 
\begin{bmatrix} 5 & 6 \\ 7 & 8 \end{bmatrix} & 
\begin{bmatrix} 9 & 10 \\ 11 & 12 \end{bmatrix}
\end{bmatrix} \\
\text{æ ·æœ¬ 1} & 
\begin{bmatrix}
\begin{bmatrix} 13 & 14 \\ 15 & 16 \end{bmatrix} & 
\begin{bmatrix} 17 & 18 \\ 19 & 20 \end{bmatrix} & 
\begin{bmatrix} 21 & 22 \\ 23 & 24 \end{bmatrix}
\end{bmatrix}
\end{bmatrix}
```

#### **1. è®¡ç®—å‡å€¼ï¼ˆMeanï¼‰**

ä»ä¸Šä¸€é—®é¢˜å·²çŸ¥ï¼š

```math
\text{mean} = \begin{bmatrix} 8.5 & 12.5 & 16.5 \end{bmatrix} \quad (\text{å½¢çŠ¶: } (1, 3, 1, 1))
```

#### **2. è®¡ç®— ( X - \text{mean} )**

å¯¹æ¯ä¸ªé€šé“ ( c )ï¼Œå‡å»å¯¹åº”çš„å‡å€¼ ( \text{mean}\_c )ï¼ˆå¹¿æ’­æœºåˆ¶ï¼‰ï¼š

```math
X - \text{mean} = \begin{bmatrix}
\text{æ ·æœ¬ 0} & 
\begin{bmatrix}
\begin{bmatrix} 1-8.5 & 2-8.5 \\ 3-8.5 & 4-8.5 \end{bmatrix} & 
\begin{bmatrix} 5-12.5 & 6-12.5 \\ 7-12.5 & 8-12.5 \end{bmatrix} & 
\begin{bmatrix} 9-16.5 & 10-16.5 \\ 11-16.5 & 12-16.5 \end{bmatrix}
\end{bmatrix} \\
\text{æ ·æœ¬ 1} & 
\begin{bmatrix}
\begin{bmatrix} 13-8.5 & 14-8.5 \\ 15-8.5 & 16-8.5 \end{bmatrix} & 
\begin{bmatrix} 17-12.5 & 18-12.5 \\ 19-12.5 & 20-12.5 \end{bmatrix} & 
\begin{bmatrix} 21-16.5 & 22-16.5 \\ 23-16.5 & 24-16.5 \end{bmatrix}
\end{bmatrix}
\end{bmatrix}
```

è®¡ç®—ç»“æœï¼š

```math
X - \text{mean} = \begin{bmatrix}
\begin{bmatrix} -7.5 & -6.5 \\ -5.5 & -4.5 \end{bmatrix} & 
\begin{bmatrix} -7.5 & -6.5 \\ -5.5 & -4.5 \end{bmatrix} & 
\begin{bmatrix} -7.5 & -6.5 \\ -5.5 & -4.5 \end{bmatrix} \\
\begin{bmatrix} 4.5 & 5.5 \\ 6.5 & 7.5 \end{bmatrix} & 
\begin{bmatrix} 4.5 & 5.5 \\ 6.5 & 7.5 \end{bmatrix} & 
\begin{bmatrix} 4.5 & 5.5 \\ 6.5 & 7.5 \end{bmatrix}
\end{bmatrix}
```

#### **3. è®¡ç®—å¹³æ–¹ ( (X - \text{mean})^2 )**

é€å…ƒç´ å¹³æ–¹ï¼š

```math
(X - \text{mean})^2 = \begin{bmatrix}
\begin{bmatrix} 56.25 & 42.25 \\ 30.25 & 20.25 \end{bmatrix} & 
\begin{bmatrix} 56.25 & 42.25 \\ 30.25 & 20.25 \end{bmatrix} & 
\begin{bmatrix} 56.25 & 42.25 \\ 30.25 & 20.25 \end{bmatrix} \\
\begin{bmatrix} 20.25 & 30.25 \\ 42.25 & 56.25 \end{bmatrix} & 
\begin{bmatrix} 20.25 & 30.25 \\ 42.25 & 56.25 \end{bmatrix} & 
\begin{bmatrix} 20.25 & 30.25 \\ 42.25 & 56.25 \end{bmatrix}
\end{bmatrix}
```

#### **4. è®¡ç®—å‡å€¼ ( \text{var} = \text{mean}((X - \text{mean})^2) )**

å¯¹æ¯ä¸ªé€šé“ ( c )ï¼Œè®¡ç®—æ‰€æœ‰æ ·æœ¬ã€æ‰€æœ‰ç©ºé—´ä½ç½®çš„å¹³æ–¹å·®çš„å‡å€¼ï¼š

*   **é€šé“ 0** çš„æ–¹å·®ï¼š

```math
    \text{var}\_0 = \frac{56.25 + 42.25 + 30.25 + 20.25 + 20.25 + 30.25 + 42.25 + 56.25}{8} = \frac{298}{8} = 37.25
```

*   **é€šé“ 1** çš„æ–¹å·®ï¼š

```math
    \text{var}\_1 = \frac{56.25 + 42.25 + 30.25 + 20.25 + 20.25 + 30.25 + 42.25 + 56.25}{8} = \frac{298}{8} = 37.25
```

*   **é€šé“ 2** çš„æ–¹å·®ï¼š

```math
    \text{var}\_2 = \frac{56.25 + 42.25 + 30.25 + 20.25 + 20.25 + 30.25 + 42.25 + 56.25}{8} = \frac{298}{8} = 37.25
```

#### **5. æœ€ç»ˆæ–¹å·®ï¼ˆä¿æŒç»´åº¦ï¼‰**

ç”±äº `keepdim=True`ï¼Œè¾“å‡ºå½¢çŠ¶ä¸º `(1, 3, 1, 1)`ï¼š

```math
\text{var} = \begin{bmatrix} 37.25 & 37.25 & 37.25 \end{bmatrix} \quad (\text{å½¢çŠ¶: } (1, 3, 1, 1))
```

***

### **å…³é”®æ€»ç»“**

1.  **è®¡ç®—æ­¥éª¤**ï¼š

```math
    \text{var} = \frac{1}{N \times H \times W} \sum\_{b=1}^N \sum\_{h=1}^H \sum\_{w=1}^W (X\_{b,c,h,w} - \text{mean}\_c)^2
```

```math
  ( N=2 )ï¼ˆbatchï¼‰ï¼Œ( H=2 )ï¼Œ( W=2 )ï¼Œ( c \in {1,2,3} )ã€‚
```

1.  **å¹¿æ’­æœºåˆ¶**ï¼šå‡å€¼å’Œæ–¹å·®è®¡ç®—æ—¶ï¼Œè‡ªåŠ¨å¹¿æ’­åˆ° `(batch, height, width)` ç»´åº¦ã€‚

2.  **è¾“å‡ºå½¢çŠ¶**ï¼š`keepdim=True` ä¿æŒé€šé“ç»´åº¦ï¼Œä¾¿äºåç»­æ“ä½œï¼ˆå¦‚ BatchNorm ä¸­çš„ç¼©æ”¾å’Œå¹³ç§»ï¼‰ã€‚

