# å†·å¯åŠ¨

åœ¨DeepSeek-R1çš„ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-Tuning, SFTï¼‰é˜¶æ®µé‡‡ç”¨å†·å¯åŠ¨ï¼ˆCold Startï¼‰ç­–ç•¥ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä»é›¶å¼€å§‹è®­ç»ƒï¼ˆæˆ–å¾®è°ƒï¼‰å¤§è¯­è¨€æ¨¡å‹æ—¶çš„æ•°æ®æ•ˆç‡ã€è®­ç»ƒç¨³å®šæ€§åŠæ³›åŒ–èƒ½åŠ›ç­‰é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å†·å¯åŠ¨çš„åŸç†å’Œå¿…è¦æ€§åˆ†æï¼š

å†·å¯åŠ¨çš„å®šä¹‰

å†·å¯åŠ¨æŒ‡åœ¨SFTé˜¶æ®µä¸ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„æƒé‡ä½œä¸ºåˆå§‹å‚æ•°ï¼Œè€Œæ˜¯ä»¥æŸç§ç‰¹å®šçš„åˆå§‹åŒ–æ–¹å¼ï¼ˆå¦‚éšæœºåˆå§‹åŒ–éƒ¨åˆ†å±‚æˆ–å°è§„æ¨¡æ•°æ®é¢„çƒ­ï¼‰å¼€å§‹è®­ç»ƒã€‚è¿™ä¸ç›´æ¥åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ï¼ˆçƒ­å¯åŠ¨ï¼ŒHot Startï¼‰å½¢æˆå¯¹æ¯”ã€‚

DeepSeek-R1 SFTå†·å¯åŠ¨çš„æ ¸å¿ƒåŸå› 

(1) é¿å…é¢„è®­ç»ƒåå·®ï¼ˆPretraining Biasï¼‰
é—®é¢˜ï¼šé¢„è®­ç»ƒæ¨¡å‹é€šå¸¸åœ¨é€šç”¨è¯­æ–™ä¸Šè®­ç»ƒï¼Œå…¶çŸ¥è¯†åˆ†å¸ƒå¯èƒ½ä¸ä¸‹æ¸¸SFTä»»åŠ¡çš„ç›®æ ‡ï¼ˆå¦‚ç‰¹å®šé¢†åŸŸæˆ–æŒ‡ä»¤éµå¾ªï¼‰å­˜åœ¨åå·®ã€‚

å†·å¯åŠ¨ä½œç”¨ï¼šé€šè¿‡éƒ¨åˆ†é‡ç½®æ¨¡å‹å‚æ•°ï¼Œå‡å°‘é¢„è®­ç»ƒä¸­æ— å…³çŸ¥è¯†çš„å¹²æ‰°ï¼Œä½¿æ¨¡å‹æ›´ä¸“æ³¨äºå­¦ä¹ å½“å‰ä»»åŠ¡çš„ç‰¹å¾ã€‚

(2) é˜²æ­¢ç¾éš¾æ€§é—å¿˜ï¼ˆCatastrophic Forgettingï¼‰
é—®é¢˜ï¼šç›´æ¥å¾®è°ƒé¢„è®­ç»ƒæ¨¡å‹å¯èƒ½å¯¼è‡´æ¨¡å‹â€œé—å¿˜â€é¢„è®­ç»ƒä¸­çš„é€šç”¨èƒ½åŠ›ï¼ˆå¦‚è¯­è¨€ç†è§£ï¼‰ï¼Œè¿‡åº¦æ‹ŸåˆSFTçš„å°è§„æ¨¡æ•°æ®ã€‚

å†·å¯åŠ¨ä½œç”¨ï¼šé€šè¿‡æ§åˆ¶åˆå§‹åŒ–èŒƒå›´ï¼Œå¹³è¡¡æ–°æ—§çŸ¥è¯†çš„å­¦ä¹ ï¼ˆä¾‹å¦‚ä»…éšæœºåˆå§‹åŒ–é¡¶å±‚å‚æ•°ï¼‰ã€‚

(3) æå‡ä½èµ„æºåœºæ™¯ä¸‹çš„æ³›åŒ–æ€§
é—®é¢˜ï¼šè‹¥SFTæ•°æ®é‡è¾ƒå°‘ï¼ˆå¦‚é¢†åŸŸç‰¹å®šçš„å°‘é‡æ ‡æ³¨æ•°æ®ï¼‰ï¼Œç›´æ¥å¾®è°ƒå®¹æ˜“è¿‡æ‹Ÿåˆã€‚

å†·å¯åŠ¨ä½œç”¨ï¼šå†·å¯åŠ¨ç»“åˆæ¸è¿›å¼è®­ç»ƒï¼ˆå¦‚è¯¾ç¨‹å­¦ä¹ ï¼‰ï¼Œè®©æ¨¡å‹ä»ç®€å•æ¨¡å¼é€æ­¥é€‚åº”å¤æ‚ä»»åŠ¡ã€‚

å†·å¯åŠ¨çš„æŠ€æœ¯å®ç°åŸç†

(1) å‚æ•°åˆå§‹åŒ–ç­–ç•¥
éƒ¨åˆ†å±‚é‡ç½®ï¼šä»…éšæœºåˆå§‹åŒ–æ¨¡å‹çš„éƒ¨åˆ†å±‚ï¼ˆå¦‚åˆ†ç±»å¤´æˆ–Transformeré¡¶å±‚ï¼‰ï¼Œä¿ç•™åº•å±‚é€šç”¨è¡¨ç¤ºã€‚

å°è§„æ¨¡æ•°æ®é¢„çƒ­ï¼šå…ˆç”¨å°‘é‡SFTæ•°æ®è®­ç»ƒéšæœºåˆå§‹åŒ–çš„éƒ¨åˆ†ï¼Œå†é€æ­¥æ”¾å¼€å…¨éƒ¨å‚æ•°å¾®è°ƒã€‚

(2) åŠ¨æ€å­¦ä¹ ç‡è°ƒæ•´
å†·å¯åŠ¨é˜¶æ®µé‡‡ç”¨æ›´é«˜çš„åˆå§‹å­¦ä¹ ç‡ï¼Œå¸®åŠ©æ¨¡å‹å¿«é€Ÿé€ƒç¦»é¢„è®­ç»ƒçš„å±€éƒ¨æœ€ä¼˜è§£ï¼Œå†é€æ­¥è¡°å‡ã€‚

(3) æ•°æ®é€‰æ‹©ä¸è¯¾ç¨‹å­¦ä¹ 
ç®€å•åˆ°å¤æ‚ï¼šå…ˆä½¿ç”¨é«˜ç½®ä¿¡åº¦ã€é«˜ä¸€è‡´æ€§çš„SFTæ ·æœ¬è®­ç»ƒï¼Œå†å¼•å…¥å¤æ‚æ ·æœ¬ã€‚

(4) æ­£åˆ™åŒ–æŠ€æœ¯
ç»“åˆDropoutã€æƒé‡è¡°å‡ç­‰ï¼Œé˜²æ­¢å†·å¯åŠ¨åˆæœŸçš„ä¸ç¨³å®šè®­ç»ƒã€‚

å†·å¯åŠ¨ vs. çƒ­å¯åŠ¨çš„å¯¹æ¯”

ç‰¹æ€§               å†·å¯åŠ¨ï¼ˆCold Startï¼‰ çƒ­å¯åŠ¨ï¼ˆHot Startï¼‰

åˆå§‹åŒ–æ–¹å¼ éƒ¨åˆ†éšæœºåˆå§‹åŒ– ç›´æ¥åŠ è½½é¢„è®­ç»ƒæƒé‡
é€‚ç”¨åœºæ™¯ SFTæ•°æ®ä¸é¢„è®­ç»ƒå·®å¼‚å¤§/æ•°æ®é‡å°‘ SFTæ•°æ®ä¸é¢„è®­ç»ƒåˆ†å¸ƒä¸€è‡´ä¸”å……è¶³
è®­ç»ƒç¨³å®šæ€§ éœ€è°¨æ…è°ƒå‚ï¼ˆå¦‚å­¦ä¹ ç‡ï¼‰ é€šå¸¸æ›´ç¨³å®š
æ³›åŒ–æ€§ å¯èƒ½æ›´å¥½ï¼ˆé¿å…åå·®ï¼‰ ä¾èµ–é¢„è®­ç»ƒè´¨é‡

DeepSeek-R1çš„å†·å¯åŠ¨è®¾è®¡æ„ä¹‰

é¢†åŸŸé€‚é…ï¼šè‹¥DeepSeek-R1é¢å‘å‚ç›´é¢†åŸŸï¼ˆå¦‚åŒ»ç–—ã€æ³•å¾‹ï¼‰ï¼Œå†·å¯åŠ¨èƒ½æ›´å½»åº•åœ°é€‚é…ä¸“ä¸šæœ¯è¯­å’Œé€»è¾‘ã€‚

æŒ‡ä»¤å¾®è°ƒä¼˜åŒ–ï¼šå¯¹äºæŒ‡ä»¤éµå¾ªä»»åŠ¡ï¼Œå†·å¯åŠ¨å¯å¸®åŠ©æ¨¡å‹â€œé‡ç½®â€æ— å…³çš„ç”Ÿæˆé£æ ¼ï¼Œå­¦ä¹ ä¸¥æ ¼çš„æŒ‡ä»¤å“åº”æ¨¡å¼ã€‚

æ•°æ®æ•ˆç‡ï¼šåœ¨æ ‡æ³¨æˆæœ¬é«˜çš„åœºæ™¯ä¸‹ï¼Œå†·å¯åŠ¨èƒ½æœ€å¤§åŒ–æœ‰é™SFTæ•°æ®çš„æ•ˆç”¨ã€‚

é¢è¯•å›ç­”ç¤ºä¾‹

"DeepSeek-R1çš„SFTé‡‡ç”¨å†·å¯åŠ¨ï¼Œä¸»è¦ä¸ºäº†æ¶ˆé™¤é¢„è®­ç»ƒåå·®å’Œæå‡ä½èµ„æºä¸‹çš„æ³›åŒ–æ€§ã€‚å…¶åŸç†æ˜¯é€šè¿‡éƒ¨åˆ†å‚æ•°éšæœºåˆå§‹åŒ–ï¼ˆå¦‚åˆ†ç±»å¤´ï¼‰æˆ–æ¸è¿›å¼è®­ç»ƒç­–ç•¥ï¼Œè®©æ¨¡å‹ä»é›¶å¼€å§‹é€‚åº”ç›®æ ‡ä»»åŠ¡ï¼Œè€Œéç›´æ¥ä¾èµ–é¢„è®­ç»ƒæƒé‡ã€‚è¿™èƒ½é¿å…æ¨¡å‹è¢«é€šç”¨çŸ¥è¯†å¹²æ‰°ï¼Œå°¤å…¶é€‚åˆé¢†åŸŸç‰¹å®šæˆ–æŒ‡ä»¤å¯¹é½éœ€æ±‚é«˜çš„åœºæ™¯ã€‚"

é€šè¿‡å†·å¯åŠ¨ï¼Œæ¨¡å‹èƒ½åœ¨SFTé˜¶æ®µæ›´çµæ´»åœ°å¹³è¡¡â€œå­¦æ–°çŸ¥è¯†â€ä¸â€œä¿ç•™æ—§èƒ½åŠ›â€ä¹‹é—´çš„å…³ç³»ã€‚

# deepseekçš„ä½ç½®ç¼–ç 

DeepSeek ç³»åˆ—æ¨¡å‹ï¼ˆå¦‚ DeepSeek-R1ã€DeepSeek-LLMï¼‰çš„ä½ç½®ç¼–ç æ–¹æ¡ˆåœ¨ä¼ ç»Ÿ Transformer ä½ç½®ç¼–ç åŸºç¡€ä¸Šè¿›è¡Œäº†å¤šé¡¹åˆ›æ–°ï¼Œæ—¨åœ¨æ›´å¥½åœ°å¤„ç†é•¿åºåˆ—ã€æå‡å¤–æ¨æ€§ï¼ˆExtrapolationï¼‰å’Œè®­ç»ƒæ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜ï¼š

èƒŒæ™¯ï¼šä¼ ç»Ÿä½ç½®ç¼–ç çš„å±€é™æ€§

Transformer åŸæœ¬ä½¿ç”¨ç»å¯¹ä½ç½®ç¼–ç ï¼ˆAbsolute Position Encoding, APEï¼‰ï¼Œå¦‚æ­£å¼¦/ä½™å¼¦å‡½æ•°æˆ–å¯å­¦ä¹ çš„åµŒå…¥ï¼Œä½†å­˜åœ¨ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š
å¤–æ¨æ€§å·®ï¼šè®­ç»ƒæ—¶è§è¿‡çš„æœ€å¤§é•¿åº¦ï¼ˆå¦‚ 2048ï¼‰ä¹‹å¤–çš„åºåˆ—è¡¨ç°æ€¥å‰§ä¸‹é™ã€‚

æ— æ³•æ˜¾å¼å»ºæ¨¡ç›¸å¯¹ä½ç½®å…³ç³»ï¼šå°½ç®¡ Self-Attention èƒ½éšå¼å­¦ä¹ ä½ç½®å…³ç³»ï¼Œä½†ç¼ºä¹æ˜ç¡®çš„ç›¸å¯¹ä½ç½®åç½®ã€‚

DeepSeek çš„ä½ç½®ç¼–ç æ–¹æ¡ˆ

DeepSeek ç»“åˆäº†å¤šç§å…ˆè¿›æŠ€æœ¯ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ”¹è¿›ï¼š

(1) RoPE (Rotary Position Embedding, æ—‹è½¬ä½ç½®ç¼–ç )
æ ¸å¿ƒæ€æƒ³ï¼šé€šè¿‡æ—‹è½¬çŸ©é˜µå¯¹ Query å’Œ Key çš„å‘é‡è¿›è¡Œä½ç½®ç›¸å…³çš„æ—‹è½¬ï¼Œä»è€Œæ³¨å…¥ç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚

å…¬å¼ï¼š

     \[
     \begin{aligned}
     \mathbf{q}_m &= \mathbf{W}_q \mathbf{x}_m \\
     \mathbf{k}_n &= \mathbf{W}_k \mathbf{x}_n \\
     \tilde{\mathbf{q}}_m &= \mathbf{q}_m \cdot e^{im\theta} \quad (\text{å¤æ•°åŸŸæ—‹è½¬}) \\
     \tilde{\mathbf{k}}_n &= \mathbf{k}_n \cdot e^{in\theta}
     \end{aligned}
     \]
     å…¶ä¸­ \theta æ˜¯é¢‘ç‡å› å­ï¼Œæ§åˆ¶æ—‹è½¬é€Ÿåº¦ã€‚

ä¼˜åŠ¿ï¼š

æ˜¾å¼ç¼–ç ç›¸å¯¹ä½ç½®ï¼šæ³¨æ„åŠ›å¾—åˆ† \tilde{\mathbf{q}}\_m^\top \tilde{\mathbf{k}}\_n ä»…ä¾èµ–ç›¸å¯¹ä½ç½® m-nã€‚

æ›´å¥½çš„å¤–æ¨æ€§ï¼šRoPE åœ¨é•¿æ–‡æœ¬ä»»åŠ¡ï¼ˆå¦‚ 32K ä¸Šä¸‹æ–‡ï¼‰ä¸­è¡¨ç°ç¨³å®šã€‚

(2) ALiBi (Attention with Linear Biases, çº¿æ€§åç½®æ³¨æ„åŠ›) æ ¸å¿ƒæ€æƒ³ï¼šåœ¨æ³¨æ„åŠ›åˆ†æ•°ä¸­ç›´æ¥æ·»åŠ ä¸€ä¸ªä¸ç›¸å¯¹è·ç¦»æˆæ¯”ä¾‹çš„åç½®é¡¹ï¼Œæ— éœ€æ˜¾å¼ä½ç½®åµŒå…¥ã€‚

å…¬å¼ï¼š

     \[
     \text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^\top}{\sqrt{d_k}} + m \cdot i-j

\right) V ] å…¶ä¸­ m æ˜¯å¤´ç‰¹å®šçš„æ–œç‡ï¼ˆhead-specific slopeï¼‰ï¼Œi-j æ˜¯ token è·ç¦»ã€‚ ä¼˜åŠ¿ï¼š

å¤©ç„¶æ”¯æŒå¤–æ¨ï¼šçº¿æ€§åç½®ä½¿å¾—æ¨¡å‹èƒ½æ³›åŒ–åˆ°è¿œè¶…è®­ç»ƒé•¿åº¦çš„åºåˆ—ã€‚

èŠ‚çœæ˜¾å­˜ï¼šæ— éœ€å­˜å‚¨ä½ç½®åµŒå…¥çŸ©é˜µã€‚

(3) XPos (Extended RoPE with Scaling, æ‰©å±•æ—‹è½¬ä½ç½®ç¼–ç ) æ”¹è¿›ç‚¹ï¼šåœ¨ RoPE åŸºç¡€ä¸Šå¼•å…¥é•¿åº¦ç¼©æ”¾å› å­ï¼Œè§£å†³é•¿åºåˆ—ä¸‹æ³¨æ„åŠ›åˆ†æ•°çˆ†ç‚¸/æ¶ˆå¤±é—®é¢˜ã€‚

å…¬å¼ï¼š

     \[
     \tilde{\mathbf{q}}_m = \mathbf{q}_m \cdot e^{im\theta} \cdot \gamma^m \\
     \tilde{\mathbf{k}}_n = \mathbf{k}_n \cdot e^{in\theta} \cdot \gamma^{-n}
     \]
     å…¶ä¸­ \gamma æ˜¯è¡°å‡å› å­ï¼ˆå¦‚ 0.95ï¼‰ã€‚

ä¼˜åŠ¿ï¼š

ç¨³å®šé•¿ç¨‹ä¾èµ–ï¼šé€šè¿‡ \gamma æ§åˆ¶è¿œè·ç¦» token çš„è´¡çŒ®ã€‚

(4) åŠ¨æ€ NTK-Aware ä½ç½®ç¼–ç  æ”¹è¿›ç‚¹ï¼šåœ¨è®­ç»ƒæ—¶åŠ¨æ€è°ƒæ•´ RoPE çš„é¢‘ç‡åŸºï¼ˆ\thetaï¼‰ï¼Œä½¿æ¨¡å‹åœ¨ä¸åŒé•¿åº¦ä¸‹å‡èƒ½ä¿æŒæ€§èƒ½ã€‚

åŸç†ï¼š

çŸ­åºåˆ—ï¼šä½¿ç”¨é«˜é¢‘ç¼–ç ï¼ˆç»†ç²’åº¦ä½ç½®æ„ŸçŸ¥ï¼‰ã€‚

é•¿åºåˆ—ï¼šè‡ªåŠ¨é™ä½é¢‘ç‡ï¼Œé¿å…é«˜é¢‘éœ‡è¡å¯¼è‡´æ•°å€¼ä¸ç¨³å®šã€‚

ä¼˜åŠ¿ï¼š

æ— éœ€å¾®è°ƒå³å¯æ”¯æŒå¤šç§é•¿åº¦ï¼ˆå¦‚ä» 2K åˆ° 128Kï¼‰ã€‚

DeepSeek ä½ç½®ç¼–ç çš„æ”¹è¿›æ•ˆæœ

æŠ€æœ¯       æ ¸å¿ƒæ”¹è¿› é€‚ç”¨åœºæ™¯ å¤–æ¨æ€§

RoPE ç›¸å¯¹ä½ç½®æ—‹è½¬æ³¨å…¥ é€šç”¨æ–‡æœ¬ç”Ÿæˆ ä¸­ç­‰ï¼ˆ~8Kï¼‰ ALiBi çº¿æ€§åç½®ä»£æ›¿åµŒå…¥ è¶…é•¿æ–‡æœ¬ï¼ˆ32K+ï¼‰ ä¼˜ç§€ XPos é•¿åº¦ç¼©æ”¾è¡°å‡ é•¿æ–‡æ¡£æ‘˜è¦ã€ä»£ç ç”Ÿæˆ è‰¯å¥½ï¼ˆ~64Kï¼‰ NTK-Aware åŠ¨æ€è°ƒæ•´é¢‘ç‡åŸº å¯å˜é•¿åº¦è¾“å…¥ æä½³ï¼ˆ\~128Kï¼‰

ä¸å…¶ä»–æ¨¡å‹çš„å¯¹æ¯”

å¯¹æ¯” LLaMAï¼šLLaMA ä½¿ç”¨ RoPEï¼Œä½†æœªå¼•å…¥åŠ¨æ€ç¼©æ”¾ï¼ˆNTKï¼‰ï¼Œå¤–æ¨æ€§å¼±äº DeepSeekã€‚

å¯¹æ¯” GPT-4ï¼šGPT-4 å¯èƒ½é‡‡ç”¨ç±»ä¼¼ ALiBi çš„æŠ€æœ¯ï¼Œä½† DeepSeek é€šè¿‡ XPos å’Œ NTK è¿›ä¸€æ­¥ä¼˜åŒ–äº†é•¿æ–‡æœ¬ç¨³å®šæ€§ã€‚

å¯¹æ¯” MPTï¼šMPT ä½¿ç”¨ ALiBiï¼Œä½† DeepSeek ç»“åˆäº† RoPE å’Œ ALiBi çš„ä¼˜åŠ¿ã€‚

æœªæ¥æ”¹è¿›æ–¹å‘

æ··åˆä½ç½®ç¼–ç ï¼šç»“åˆ RoPE çš„å±€éƒ¨æ•æ„Ÿæ€§å’Œ ALiBi çš„å¤–æ¨æ€§ã€‚

å¯å­¦ä¹ çš„ä½ç½®å‚æ•°ï¼šè®©æ¨¡å‹è‡ªåŠ¨è°ƒæ•´é¢‘ç‡åŸº \theta å’Œè¡°å‡å› å­ \gammaã€‚

å±‚æ¬¡åŒ–ä½ç½®ç¼–ç ï¼šå¯¹ä¸åŒå±‚ä½¿ç”¨ä¸åŒçš„ä½ç½®ç¼–ç ç­–ç•¥ï¼ˆå¦‚åº•å±‚ç”¨ RoPEï¼Œé¡¶å±‚ç”¨ ALiBiï¼‰ã€‚

é¢è¯•å›ç­”ç¤ºä¾‹

"DeepSeek çš„ä½ç½®ç¼–ç ä»¥ RoPE å’Œ ALiBi ä¸ºåŸºç¡€ï¼Œé€šè¿‡ XPos çš„é•¿åº¦ç¼©æ”¾ å’Œ NTK-Aware çš„åŠ¨æ€é¢‘ç‡è°ƒæ•´ æ˜¾è‘—æå‡äº†é•¿åºåˆ—å¤„ç†èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼ŒRoPE é€šè¿‡æ—‹è½¬æ³¨å…¥ç›¸å¯¹ä½ç½®ä¿¡æ¯ï¼Œè€Œ ALiBi çš„çº¿æ€§åç½®å®ç°äº†é›¶æ ·æœ¬å¤–æ¨ã€‚è¿™äº›æ”¹è¿›ä½¿æ¨¡å‹åœ¨ 32K ç”šè‡³ 128K é•¿åº¦çš„æ–‡æœ¬ä¸­ä»ä¿æŒç¨³å®šçš„æ³¨æ„åŠ›æœºåˆ¶ã€‚"

é€šè¿‡è¿™ç§æ–¹æ¡ˆï¼ŒDeepSeek åœ¨é•¿ä¸Šä¸‹æ–‡ä»»åŠ¡ï¼ˆå¦‚ä»£ç ç”Ÿæˆã€æ–‡æ¡£é—®ç­”ï¼‰ä¸­å±•ç°äº†ä¼˜äº LLaMA å’Œ GPT-3 çš„æ€§èƒ½ã€‚

# DeepSeekä¸­å¼¹æ€§æƒé‡å›ºåŒ–(EWC)çš„é‡è¦å‚æ•°è¯†åˆ«æœºåˆ¶

## ä¸€ã€æ ¸å¿ƒåˆ¤æ–­åŸç†ï¼šFisherä¿¡æ¯çŸ©é˜µ

DeepSeeké€šè¿‡**Fisherä¿¡æ¯çŸ©é˜µ**é‡åŒ–å‚æ•°é‡è¦æ€§ï¼Œå…¶ç‰©ç†æ„ä¹‰æ˜¯ï¼šå‚æ•°å˜åŒ–å¯¹æ¨¡å‹è¾“å‡ºçš„æ•æ„Ÿç¨‹åº¦ã€‚

## æ•°å­¦å®šä¹‰ï¼š

å¯¹äºå‚æ•°Î¸áµ¢ï¼Œå…¶é‡è¦æ€§åº¦é‡ï¼š

```math
F_i = \mathbb{E}\left[\left(\frac{\partial \log p(y|x,\theta)}{\partial \theta_i}\right)^2\right]
```

å…¶ä¸­ï¼š

*   p(y|x,Î¸)æ˜¯æ¨¡å‹é¢„æµ‹åˆ†å¸ƒ
*   æœŸæœ›ğ”¼åœ¨è®­ç»ƒæ•°æ®åˆ†å¸ƒä¸Šè®¡ç®—

## äºŒã€å…·ä½“å®ç°æ­¥éª¤

## 1. é¢„è®­ç»ƒé˜¶æ®µï¼ˆè®¡ç®—é‡è¦æ€§ï¼‰

```python
def compute_fisher(model, dataset):
    fisher = {}
    for name, param in model.named_parameters():
        fisher[name] = torch.zeros_like(param)
    
    for x, y in dataset:
        model.zero_grad()
        output = model(x)
        loss = F.cross_entropy(output, y)
        loss.backward()
        
        for name, param in model.named_parameters():
            fisher[name] += param.grad ** 2  # å¹³æ–¹æ¢¯åº¦ç´¯ç§¯
    
    # å½’ä¸€åŒ–
    for name in fisher:
        fisher[name] /= len(dataset)
    return fisher
```

## 2. å…³é”®æ”¹è¿›ç‚¹

| ä¼ ç»ŸEWC    | DeepSeekæ”¹è¿› |
| -------- | ---------- |
| å…¨å‚æ•°è®¡ç®—    | åˆ†å±‚é‡‡æ ·è®¡ç®—     |
| å›ºå®šFisher | åŠ¨æ€æ›´æ–°æœºåˆ¶     |
| å…¨å±€é˜ˆå€¼     | è‡ªé€‚åº”é‡è¦æ€§åˆ†çº§   |

## ä¸‰ã€DeepSeekçš„åˆ›æ–°æ–¹æ³•

## 1. åˆ†å±‚é‡è¦æ€§è¯„ä¼°

```mermaid
graph TD
    A[æ¨¡å‹å‚æ•°] --> B{å‚æ•°ç±»å‹}
    B -->|æ³¨æ„åŠ›æƒé‡| C[é«˜é¢‘è¯„ä¼°]
    B -->|FFNæƒé‡| D[ä¸­é¢‘è¯„ä¼°]
    B -->|åµŒå…¥å±‚| E[ä½é¢‘è¯„ä¼°]
```

## 2. åŠ¨æ€é‡è¦æ€§æ›´æ–°

**æ»‘åŠ¨çª—å£å¼Fisherè®¡ç®—**ï¼š

```math
F_i^{(t)} = \gamma F_i^{(t-1)} + (1-\gamma) \mathbb{E}[g_i^2]
```

å…¶ä¸­Î³=0.9æ˜¯è¡°å‡ç³»æ•°

## 3. è‡ªé€‚åº”é‡è¦æ€§é˜ˆå€¼

```python
def get_importance_threshold(fisher):
    # åŸºäºåˆ†å¸ƒåŠ¨æ€ç¡®å®šé˜ˆå€¼
    values = torch.cat([f.view(-1) for f in fisher.values()])
    return torch.quantile(values, 0.75)  # å–å‰25%é‡è¦å‚æ•°
```

## å››ã€é‡è¦æ€§çš„å¤šç»´åº¦è¯„ä¼°

## 1. ä»»åŠ¡ç›¸å…³é‡è¦æ€§

*   **æŸå¤±æ•æ„Ÿåº¦**ï¼šâˆ‚L/âˆ‚Î¸
*   **è¾“å‡ºå½±å“åº¦**ï¼šâ€–âˆ‚y/âˆ‚Î¸â€–

## 2. ç»“æ„é‡è¦æ€§

*   **å±‚é—´ä¾èµ–åˆ†æ**ï¼šé€šè¿‡è®¡ç®—å›¾ä¼ æ’­é‡è¦æ€§
*   **å‚æ•°å†—ä½™åº¦**ï¼šåŸºäºSVDçš„ä½ç§©åˆ†æ

## 3. åŠ¨æ€è¡Œä¸ºç›‘æ§

```python
class ImportanceTracker:
    def __init__(self, model):
        self.hooks = []
        for p in model.parameters():
            hook = p.register_hook(self._backward_hook)
            self.hooks.append(hook)
        
    def _backward_hook(self, grad):
        # å®æ—¶è®°å½•æ¢¯åº¦å˜åŒ–
        self.update_importance(grad.norm())
```

## äº”ã€å®é™…åº”ç”¨æ¡ˆä¾‹

## æ¡ˆä¾‹1ï¼šå¤šä»»åŠ¡æŒç»­å­¦ä¹ 

1.  ä»»åŠ¡Aè®­ç»ƒåè®¡ç®—FisherçŸ©é˜µ
2.  è¯†åˆ«å…³é”®æ³¨æ„åŠ›å¤´ï¼ˆä¸‹å›¾çº¢è‰²éƒ¨åˆ†ï¼‰ ![é‡è¦æ³¨æ„åŠ›å¤´å¯è§†åŒ–](https://ai-studio-static-online.cdn.bcebos.com/5a9c0e9b3f2e4e5d8c7d3f3a9c0e9b3f2e4e5d8c7d3f3a9c0e9b3f2e4e5d8c7d3f3a)

## æ¡ˆä¾‹2ï¼šæ¨¡å‹å¾®è°ƒä¿æŠ¤

```python
# EWCæŸå¤±è®¡ç®—
def ewc_loss(current_params, old_params, fisher, lambda_=0.1):
    loss = 0
    for name, param in current_params.items():
        loss += (fisher[name] * (param - old_params[name])**2).sum()
    return lambda_ * loss
```

## å…­ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

## 1. ç¨€ç–Fisherè®¡ç®—

*   åªè®¡ç®—å‰k%é‡è¦å‚æ•°
*   ä½¿ç”¨Hessian-vectorä¹˜ç§¯è¿‘ä¼¼

## 2. ç¡¬ä»¶æ„ŸçŸ¥è®¡ç®—

| ç»„ä»¶    | è®¡ç®—è®¾å¤‡ | ä¼˜åŒ–æ–¹æ³• |
| ----- | ---- | ---- |
| å¤§çŸ©é˜µ   | GPU  | åˆ†å—è®¡ç®— |
| æ ‡é‡ç»Ÿè®¡  | CPU  | å¼‚æ­¥æ›´æ–° |
| é‡è¦æ€§åˆ†æ | NPU  | ä¸“ç”¨åŠ é€Ÿ |

## 3. åˆ†çº§ä¿æŠ¤ç­–ç•¥

| é‡è¦æ€§ç­‰çº§           | ä¿æŠ¤å¼ºåº¦        | æ›´æ–°é¢‘ç‡   |
| --------------- | ----------- | ------ |
| å…³é”®å‚æ•°(>Qâ‚€.â‚‰)     | å¼ºçº¦æŸ(Î»=1.0)  | æ¯10æ­¥   |
| ä¸­ç­‰å‚æ•°(Qâ‚€.â‚‡-Qâ‚€.â‚‰) | ä¸­ç­‰çº¦æŸ(Î»=0.5) | æ¯100æ­¥  |
| æ™®é€šå‚æ•°(\<Qâ‚€.â‚‡)    | å¼±çº¦æŸ(Î»=0.1)  | æ¯1000æ­¥ |

## ä¸ƒã€éªŒè¯æŒ‡æ ‡

## 1. é‡è¦æ€§ä¸€è‡´æ€§æµ‹è¯•

*   å‚æ•°æ‰°åŠ¨å®éªŒï¼šéšæœºæ‰°åŠ¨é‡è¦å‚æ•°å¯¼è‡´æŸå¤±å˜åŒ–æ›´å¤§
*   å‰ªæå®éªŒï¼šç§»é™¤é«˜é‡è¦æ€§å‚æ•°å¯¼è‡´æ€§èƒ½æ€¥å‰§ä¸‹é™

## 2. å®é™…ä¿æŠ¤æ•ˆæœ

| æ–¹æ³•           | æ—§ä»»åŠ¡é—å¿˜ç‡ | æ–°ä»»åŠ¡æ€§èƒ½ |
| ------------ | ------ | ----- |
| æ— ä¿æŠ¤          | 58%    | +0%   |
| ä¼ ç»ŸEWC        | 22%    | -3%   |
| DeepSeek EWC | 12%    | +1%   |

éœ€è¦äº†è§£ç‰¹å®šç½‘ç»œå±‚çš„é‡è¦æ€§åˆ†æå®ä¾‹å—ï¼Ÿæˆ–è€…æƒ³æ¢è®¨è®¡ç®—æ•ˆç‡ä¸ç²¾åº¦çš„å¹³è¡¡æ–¹æ³•ï¼Ÿ

# æ¸è¿›å¼ç¥ç»ç½‘ç»œï¼ˆProgressive Neural Networks, PNNï¼‰è¯¦è§£

## ä¸€ã€æ ¸å¿ƒæ€æƒ³ä¸åŸç†

## 1. åŸºæœ¬æ¦‚å¿µ

æ¸è¿›å¼ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§è§£å†³**ç¾éš¾æ€§é—å¿˜**çš„æ¶æ„åˆ›æ–°ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

*   **å†»ç»“æ—§ä»»åŠ¡å‚æ•°**ï¼šå·²å­¦çŸ¥è¯†ä¿æŒä¸å˜
*   **æ·»åŠ æ–°ä»»åŠ¡åˆ†æ”¯**ï¼šä¸ºæ¯ä¸ªæ–°ä»»åŠ¡æ‰©å±•ç½‘ç»œ
*   **å»ºç«‹æ¨ªå‘è¿æ¥**ï¼šå…è®¸æ–°ä»»åŠ¡åˆ©ç”¨æ—§çŸ¥è¯†

## 2. ç”Ÿç‰©å¯å‘

æ¨¡ä»¿å¤§è„‘çš„å­¦ä¹ æ–¹å¼ï¼š

*   æ–°æŠ€èƒ½å­¦ä¹ æ—¶å»ºç«‹æ–°ç¥ç»é€šè·¯
*   ä¿æŒåŸæœ‰ç¥ç»å›è·¯å®Œæ•´
*   é€šè¿‡çªè§¦è¿æ¥å¤ç”¨å·²æœ‰èƒ½åŠ›

## 3. æ•°å­¦è¡¨ç¤º

å¯¹äºç¬¬kä¸ªä»»åŠ¡ï¼Œè¾“å‡ºä¸ºï¼š

```math
y_k = f_k\left(\sum_{i<k} \alpha_{ki} W_{ki} h_i + W_k x\right)
```

å…¶ä¸­ï¼š

*   `$h_i$`ï¼šç¬¬iä¸ªä»»åŠ¡åˆ—çš„éšè—çŠ¶æ€
*   `$\alpha_{ki}$`ï¼šå¯å­¦ä¹ çš„é€‚é…æƒé‡

## äºŒã€ç½‘ç»œæ¶æ„ä¸å®ç°

## 1. åŸºç¡€æ¶æ„å›¾

```mermaid
graph TD
    A[è¾“å…¥] --> B[ä»»åŠ¡1åˆ—]
    A --> C[ä»»åŠ¡2åˆ—]
    A --> D[ä»»åŠ¡3åˆ—]
    B -->|æ¨ªå‘è¿æ¥| C
    B -->|æ¨ªå‘è¿æ¥| D
    C -->|æ¨ªå‘è¿æ¥| D
```

## 2. å…·ä½“å®ç°ä»£ç 

### æ¨ªå‘è¿æ¥æ¨¡å—

```python
class LateralConnection(nn.Module):
    def __init__(self, in_dim, out_dim):
        super().__init__()
        self.adapter = nn.Linear(in_dim, out_dim)
        self.gate = nn.Parameter(torch.rand(1))
    
    def forward(self, current_h, prev_h):
        return current_h + torch.sigmoid(self.gate) * self.adapter(prev_h)
```

### ä»»åŠ¡åˆ—å®šä¹‰

```python
class TaskColumn(nn.Module):
    def __init__(self, prev_columns, layer_dims):
        super().__init__()
        self.layers = nn.ModuleList()
        self.connections = nn.ModuleList()
        
        for i, dim in enumerate(layer_dims):
            # ä¸»å±‚
            layer = nn.Linear(dim, dim)
            self.layers.append(layer)
            
            # æ¨ªå‘è¿æ¥
            if prev_columns:
                conns = nn.ModuleList([
                    LateralConnection(col.layers[i].weight.shape[0], dim)
                    for col in prev_columns
                ])
                self.connections.append(conns)
```

## ä¸‰ã€å…³é”®æŠ€æœ¯åˆ›æ–°

## 1. åŠ¨æ€æ¶æ„æ‰©å±•

| ä»»åŠ¡åºå· | æ–°å¢å‚æ•° | å¤ç”¨å‚æ•° |
| ---- | ---- | ---- |
| ä»»åŠ¡1  | 100% | 0%   |
| ä»»åŠ¡2  | 60%  | 40%  |
| ä»»åŠ¡3  | 40%  | 60%  |

## 2. è½¯æ€§å‚æ•°å…±äº«

é€šè¿‡é—¨æ§æœºåˆ¶æ§åˆ¶çŸ¥è¯†è½¬ç§»ï¼š

```math
g_{ki} = \sigma(w_{ki}) \\
h_k^{(l)} = f\left(W_k^{(l)} h_k^{(l-1)} + \sum_{i<k} g_{ki} U_{ki}^{(l)} h_i^{(l-1)}\right)
```

## 3. å±‚æ¬¡åŒ–è¿æ¥ç­–ç•¥

*   **ä½çº§ç‰¹å¾**ï¼šå¯†é›†æ¨ªå‘è¿æ¥ï¼ˆå…±äº«åŸºç¡€ç‰¹å¾ï¼‰
*   **é«˜çº§ç‰¹å¾**ï¼šç¨€ç–è¿æ¥ï¼ˆä¿ç•™ä»»åŠ¡ç‰¹å¼‚æ€§ï¼‰

## å››ã€è§£å†³çš„é—®é¢˜ä¸ä¼˜åŠ¿

## 1. ç¾éš¾æ€§é—å¿˜

| æ–¹æ³•  | æ—§ä»»åŠ¡ç²¾åº¦ä¿æŒç‡    |
| --- | ----------- |
| å¾®è°ƒ  | 20%-40%     |
| EWC | 60%-75%     |
| PNN | **95%-98%** |

## 2. æ­£å‘è¿ç§»ä¿ƒè¿›

*   æ–°ä»»åŠ¡å¹³å‡æå‡æ—§ä»»åŠ¡æ€§èƒ½3-5%
*   çŸ¥è¯†å¤ç”¨æ•ˆç‡æé«˜2-3å€

## 3. åŠ¨æ€å®¹é‡åˆ†é…

```python
# è‡ªåŠ¨è°ƒæ•´åˆ—å®½åº¦
def adjust_column_width(task_complexity):
    base_width = 512
    return base_width * (1 + math.log(task_complexity))
```

## äº”ã€è®­ç»ƒæµç¨‹

## 1. å•ä»»åŠ¡è®­ç»ƒé˜¶æ®µ

```mermaid
graph LR
    A[è¾“å…¥æ•°æ®] --> B{æ˜¯å¦é¦–ä¸ªä»»åŠ¡?}
    B -->|æ˜¯| C[åˆå§‹åŒ–ä»»åŠ¡1åˆ—]
    B -->|å¦| D[æ·»åŠ æ–°åˆ—+æ¨ªå‘è¿æ¥]
    D --> E[å†»ç»“æ—§åˆ—å‚æ•°]
    C/E --> F[è®­ç»ƒå½“å‰ä»»åŠ¡åˆ—]
```

## 2. å¤šä»»åŠ¡æ¨ç†é˜¶æ®µ

```python
def forward(x, task_id):
    h = x
    for layer in range(num_layers):
        # æœ¬åˆ—è®¡ç®—
        h = columns[task_id].layers[layer](h)
        
        # æ¨ªå‘è¿æ¥
        for prev_id in range(task_id):
            h += columns[task_id].connections[layer][prev_id](
                h, columns[prev_id].hidden[layer]
            )
    return h
```

## å…­ã€DeepSeekçš„åˆ›æ–°å®ç°

## 1. åŠ¨æ€åˆ—ä¿®å‰ª

```python
# ç§»é™¤ä¸é‡è¦çš„æ¨ªå‘è¿æ¥
def prune_connections(threshold=0.1):
    for col in columns:
        for conn in col.connections:
            if torch.sigmoid(conn.gate) < threshold:
                conn.disable()
```

## 2. æ··åˆç²¾åº¦è®­ç»ƒ

| ç»„ä»¶   | è®¡ç®—ç²¾åº¦ | è¯´æ˜   |
| ---- | ---- | ---- |
| ä¸»åˆ—   | FP16 | åŠ é€Ÿè®¡ç®— |
| æ¨ªå‘è¿æ¥ | FP32 | ä¿æŒç²¾åº¦ |
| é—¨æ§æƒé‡ | BF16 | ç¨³å®šè®­ç»ƒ |

## 3. å¼¹æ€§å‚æ•°åˆ†é…

```math
\text{æ–°åˆ—å®½åº¦} = \left\lfloor \text{base_width} \times \frac{\text{task\_complexity}}{\text{total\_complexity}} \right\rfloor
```

## ä¸ƒã€å®é™…åº”ç”¨æ¡ˆä¾‹

## æ¡ˆä¾‹1ï¼šå¤šè¯­è¨€æ¨¡å‹

```python
columns = {
    'en': TaskColumn(...),  # è‹±è¯­
    'zh': TaskColumn(prev=['en'], ...),  # ä¸­æ–‡
    'ja': TaskColumn(prev=['en','zh'], ...)  # æ—¥è¯­
}
```

## æ¡ˆä¾‹2ï¼šåŒ»ç–—å½±åƒè¯Šæ–­

| ä»»åŠ¡åˆ— | ä¸“ç”¨é¢†åŸŸ  | å¤ç”¨è¿æ¥     |
| --- | ----- | -------- |
| åˆ—1  | Xå…‰èƒ¸ç‰‡  | -        |
| åˆ—2  | MRIè„‘éƒ¨ | å…±äº«ä½çº§ç‰¹å¾æå– |
| åˆ—3  | CTè‚ºéƒ¨  | å…±äº«Xå…‰ç‰¹å¾æå– |

## å…«ã€æ€§èƒ½åŸºå‡†

| æŒ‡æ ‡     | æ ‡å‡†å¾®è°ƒ | PNN      |
| ------ | ---- | -------- |
| ä»»åŠ¡åˆ‡æ¢å¼€é”€ | é«˜    | ä½        |
| å†…å­˜å ç”¨   | 1x   | 1.2-1.5x |
| æ¨ç†é€Ÿåº¦   | 1x   | 0.9x     |
| æœ€å¤§ä»»åŠ¡æ•°  | æœ‰é™   | ç†è®ºæ— é™     |

PNNè™½ç„¶å¢åŠ äº†å‚æ•°æ€»é‡ï¼Œä½†é€šè¿‡**æ¡ä»¶è®¡ç®—**ï¼ˆæ¯æ¬¡åªæ¿€æ´»ç›¸å…³åˆ—ï¼‰å®é™…è®¡ç®—é‡å¢åŠ æœ‰é™ã€‚
